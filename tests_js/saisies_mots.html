[(#AUTORISER{webmestre}|oui)
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tests Saisies de Mots-Clés</title>
    <link rel="stylesheet" href="#CHEMIN{tests_js/qunit-1.18.0.css}">
    #INSERT_HEAD

    <script>
        $(function () {
            /* donner des classes aux saisies pour les retrouver ensuite
               plus facilement dans les tests */
            function classer_saisie_groupe (contenu_saisie, prefix='') {

                contenu_saisie.children('.choix_groupe_mots').each(function (i, groupe_mot) {
                    var classe = prefix + '-' + 'g' + parseInt(i, 10);
                    $(groupe_mot).addClass(classe);
                    classer_saisie_groupe(
                        $(groupe_mot)
                            .children('fieldset')
                            .children('.contenu'),
                        classe);
                });

                contenu_saisie.children('.choix_mot').each(function (i, mot) {
                    var classe = prefix + '-' + 'm' + parseInt(i, 10);
                    $(mot).addClass(classe);
                });
            }

            classer_saisie_groupe($('.editer_mots_arbo'));
        });
    </script>

  </head>
  <body>
    <div id="qunit"></div>
    <div id="qunit-fixture">
      #FORMULAIRE_TESTER_SAISIES_MOTS
    </div>

    [(#REM) On met un argument qui ne sert à rien dans l'action pour
            éviter un warning (SPIP 3.0.20) ]
    #BOUTON_ACTION{effacer groupe de mots-clés de test,
                   #URL_ACTION_AUTEUR{effacer_mots_test, non}}

    <script src="#CHEMIN{tests_js/qunit-1.18.0.js}"></script>
    <script>

     QUnit.module("Saisie checkbox_mots_arborescents", {
       beforeEach: function (assert) {
         $('.editer_mots_arbo').saisiesMotsClesArbo({
           demarrer_plie: true,
           vitesse_animation: 0
         });
       }
     });

     /* Si la saisie n'est pas présente, c'est probablement que les
        plugin GMA et/ou objecteur ne sont pas activés */
     QUnit.test( "Plugins GMA et objecteur activés", function( assert ) {
       assert.equal( $('.editer_mots_arbo').length, 1, "Saisie présente !" );
     });

     QUnit.test( "Plier/déplier un groupe", function( assert ) {
       var legende_g0 = $('.-g0').find('legend').first();

       assert.ok( legende_g0.hasClass('plie'), "Au début le premier groupe est replié." );

       legende_g0.click();
       assert.notOk( legende_g0.hasClass('plie'), "Un clic permet de le déplier.");

       legende_g0.click();
       assert.ok( legende_g0.hasClass('plie'), "Un nouveau clic le replie.");
     });

    QUnit.test( "Plier/déplier un groupe pré-coché", function( assert ) {
      var legende_g1 = $('.-g1').find('legend').first();

      assert.notOk( legende_g1.hasClass('plie'), "Au début le deuxième groupe est déplié, car il est pré-coché." );

      legende_g1.click();
      assert.ok( legende_g1.hasClass('plie'), "Un clic permet de le replier.");

      legende_g1.click();
      assert.notOk( legende_g1.hasClass('plie'), "Un nouveau clic le déplie à nouveau.");
    });

    QUnit.test( "Déplier un groupe lorsqu'on coche un de ses mots", function( assert ) {
      var legende_g0 = $('.-g0').find('legend').first();

      assert.ok( legende_g0.hasClass('plie'), "Le groupe est d'abord replié" );

      $('.-g0-m0').children('input').click();
      assert.notOk( legende_g0.hasClass('plie'), "Cocher un sous-mot déplie le groupe.");
    });

    /* Une assertion pour voir si un mot est coché */
    QUnit.assert.checked = function( mot, message ) {
      var actual = $(mot).children('input').attr('checked');
      this.push(actual === 'checked', actual, 'checked', message);
    };

    QUnit.test( "Cocher les sous-mot et les frères quand on coche un mot maître", function( assert ) {

      $('.-g1-m0').children('input').click();
      assert.checked( '.-g1-m1', "Les frères sont cochés" );
      assert.checked( '.-g1-m2', "Les frères sont cochés" );
      assert.checked( '.-g1-m3', "Les frères sont cochés" );
      assert.checked( '.-g1-g0-m0', "Les sous-mots sont cochés" );
      assert.checked( '.-g1-g0-m1', "Les sous-mots sont cochés" );
      assert.checked( '.-g1-g0-m2', "Les sous-mots sont cochés" );
      assert.checked( '.-g1-g1-m0', "Les sous-mots sont cochés" );
      assert.checked( '.-g1-g1-m1', "Les sous-mots sont cochés" );
      assert.checked( '.-g1-g1-m2', "Les sous-mots sont cochés" );
      assert.checked( '.-g1-g1-m3', "Les sous-mots sont cochés" );
    });

    </script>
  </body>
</html>
]
